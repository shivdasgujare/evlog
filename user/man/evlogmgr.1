."Generated by db2man.xsl. Don't modify this, modify the source.
.de Sh \" Subsection
.br
.if t .Sp
.ne 5
.PP
\fB\\$1\fR
.PP
..
.de Sp \" Vertical space (when we can't use .PP)
.if t .sp .5v
.if n .sp
..
.de Ip \" List item
.br
.ie \\n(.$>=3 .ne \\$3
.el .ne 3
.IP "\\$1" \\$2
..
.TH "evlogmgr"  "" "" ""
.SH NAME
evlogmgr \- Event log manager
.SH "SYNOPSIS"
\fBevlogmgr\fR   \fB-c\fR | \fB--compact  \fIfilter\fR \fR 
 [ \fB-F\fR | \fB--force\fR ] [ \fB-C\fR | \fB--compr-bak\fR ] 
 [[\fB \fB-p\fR | \fB--private\fR \fR ] | [\fB \fB-l\fR | \fB--log  \fIsrcfile\fR \fR \fR]]

\fBevlogmgr\fR   \fB-f\fR | \fB--fix\fR  
 [[\fB \fB-p\fR | \fB--private\fR \fR ] | [\fB \fB-l\fR | \fB--log  \fIsrcfile\fR \fR \fR]]

\fBevlogmgr\fR   \fB-s\fR | \fB--show-status  \fIfilter\fR \fR  
 [[\fB \fB-p\fR | \fB--private\fR \fR ] | [\fB \fB-l\fR | \fB--log  \fIsrcfile\fR \fR \fR]]
.SH "DESCRIPTION"

.PP
The \fBevlogmgr\fR command performs log management on the event log, on the private log, or optionally, on a log file that you specify. You also specify which events are to be deleted. The space freed by deleted events is reused for undeleted events (a process referred to as compaction) and the log file is truncated, thus reducing its overall size.

.PP
You must have root permission to use this command.

.SH "OPTIONS"

.TP
-\fBc\fR, --\fBcompact\fR \fIfilter\fR 
Deletes event records in the event log matching the specified filter, fills space freed by deleting the event records (by moving later records into the free space), and then truncates the log thus establishing a new write offset for new events. The sequential order of events in the event log is maintained during this process and the record ids of the remaining event records are left unchanged. See the \fBevlquery\fR man page for more information about the \fIfilter\fR.

Before the compaction process begins, a backup copy of the log file is created if space is available. Following successful compaction, the backup copy is deleted. If the \fBevlogmgr\fR command is issued from the command line, and the user types Ctrl-C, then the active log file is restored from the backup copy. In the event that the system reboots before compaction completes, the active log file is restored from the backup copy (after reboot).

Unless the --\fBprivate\fR or --\fBlog\fR options are used, log management is performed on \fI/var/evlog/eventlog\fR.

The --\fBforce\fR option should only be used as a last resort. If space is not available to create a backup (compressed or uncompressed), then this option forces compaction to occur without first creating a backup of the log file. If compaction does not complete successfully, then the \fBevlogmgr\fR command with the --\fBfix\fR option (see below) might be able to restore the log file to a usable state.

The --\fBcompr-bak\fR option specifies that the backup log file created prior to compacting the original log file should be compressed. This option will take longer, but limited space might require its use.

The --\fBprivate\fR option specifies that compaction should be performed on \fI/var/evlog/privatelog\fR. This option is not valid in combination with the --\fBlog\fR option.

The --\fBlog\fR option specifies an alternate log file, \fIsrcfile\fR, to be compacted. This option is not valid in combination with the --\fBprivate\fR option.

.TP
-\fBf\fR, --\fBfix\fR 
This option is used to repair a corrupted log file, and is required only in cases where the --\fBforce\fR option was used and the log management tasks terminated before completion.

Each record in the event log is validated, and any records that are deemed invalid are deleted and replaced by valid records in the log. The command reports the total number of bytes deleted.

Some of the error messages that will indicate the need to repair the log include:

\(bu Input/output error (from evlview)
.Pp

\(bu Failed to count record for deletion 
    (from evlogmgr -s)
.Pp

\(bu Failed to compact log  (from evlogmgr -c)
.Pp

Unless the --\fBprivate\fR or --\fBlog\fR options are used, repair is performed on \fI/var/evlog/eventlog\fR.

The --\fBprivate\fR option specifies that repair should be performed on \fI/var/evlog/privatelog\fR. This option is not valid in combination with the --\fBlog\fR option.

The --\fBlog\fR option specifies an alternate log file, \fIsrcfile\fR, to be repaired. This option is not valid in combination with the --\fBprivate\fR option.

.TP
-\fBs\fR, --\fBshow-status\fR \fIfilter\fR 
Shows how many records in the event log match the \fIfilter\fR, and shows the total number of records in the log. See the \fBevlquery\fR man page for more information about the \fIfilter\fR.

Unless the --\fBprivate\fR or --\fBlog\fR options are used, status is shown for \fI/var/evlog/eventlog\fR.

The --\fBprivate\fR option specifies that status should be shown for \fI/var/evlog/privatelog\fR. This option is not valid in combination with the --\fBlog\fR option.

The --\fBlog\fR option specifies that status should be shown for an alternate log file, \fIsrcfile\fR. This option is not valid in combination with the --\fBprivate\fR option.

.SH "EXAMPLES"

.TP
Example 1
Run \fBevlogmgr\fR -\fBc\fR from a cron job. See "man 5 crontab" for more details.

# Daily at 2 AM remove recds older than 30 days

0 2 * * * root /sbin/evlogmgr -c 'age > "30d"'

      

# Daily at 1 AM remove recds w/ sev=DEBUG

0 1 * * * root /sbin/evlogmgr -c "severity=DEBUG"

.TP
Example 2
Issuing the following command:

   evlogmgr -c 'severity=DEBUG' -C 
   
might result in the following events being appended to the log:

recid=589, size=74, format=STRING, event_type=0x2, facility=LOGMGMT, 
severity=NOTICE, uid=root, gid=root, pid=18653, pgrp=18653, 
time=Thu 09 May 2002 12:59:08 PM PDT, flags=0x0, thread=0x400, processor=0
Log compaction on /var/evlog/eventlog starts at Thu May 09 12:59:08 2002
          
recid=591, size=69, format=STRING, event_type=0x3, facility=LOGMGMT, 
severity=NOTICE, uid=root, gid=root, pid=18653, pgrp=18653, 
time=Thu 09 May 2002 12:59:09 PM PDT, flags=0x0, thread=0x400, processor=0
Log compaction on /var/evlog/eventlog ended. 48 events were removed. 
.TP
Example 3
Issuing the following command:

   evlogmgr -s 'severity=DEBUG'
 
might display the following:

   Total number of records is 294.
   Number of records matching the filter is 48.
   Log file size would be reduced by 5.00 kbytes
.TP
Example 4
Issuing the following command:

   evlogmgr --fix
  
might display the following:

  Found a corrupted event record. Trying to resync with next good record...
  Log repair finished, problem fixed.  Discarded 6 bytes. 
.SH "FILES"

.TP
\fI/var/evlog/eventlog\fR
standard event log

.TP
\fI/var/evlog/privatelog\fR
private event log

.SH "SEE ALSO"
\fIevlquery man page\fR    Filter expression syntax rules

