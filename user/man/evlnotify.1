.\" This manpage has been modified by Dennis Grace
.\" of IBM LTC Documentation Services from a document
.\" that was automatically generated by docbook2man
.\" from a DocBook document.  This tool can be found at:
.\" <http://shell.ipoline.com/~elmert/comp/docbook2X/>
.\" Please send any bug reports, improvements, comments, patches,
.\" etc. to Steve Cheng <steve@ggi-project.org>.
.\" For questions regarding the modifications from the
.\" docbook2man output, contact Dennis Grace at
.\" <dgrace@us.ibm.com>.
.TH "EVLNOTIFY" "" "14 September 2001" "" ""
.SH NAME

evlnotify \- Event Notification

.SH SYNOPSIS

\fBevlnotify\fR \fB -l | --list\fR

\fBevlnotify\fR \fB -s | --show name\fR

\fBevlnotify\fR \fB -S | --showall\fR

\fBevlnotify\fR\fB -a | --add \fR \fB\fInotify-action\fB \fR [\fB-t | --threshold n -i | --interval <n|s|m|h|d>\fR] [\fB-n | --name <name>\fR] [\fB-y | --any <attribute name in template>\fR] [\fB-o | --once-only\fR]  [\fB-f | --filter \fIfilter\fB\fR]  [\fB-p | --persistent\fR]  [\fB-u | --uid \fIuserid\fB\fR]

\fBevlnotify\fR \fB -d | --delete \fInotify-id\fB\fR\fI ...\fR

\fBevlnotify\fR \fB -c | --change \fR \fB\fInew-notify-action\fB \fR \fB\fInotify-id\fB

\fR\fBevlnotify\fR \fB -F | --file\fR \fB\fIcmd-file\fB
\fR

.SH "DESCRIPTION"
.PP
The \fBevlnotify\fR command lets you
register actions to be taken when a specified event occurs. An
action (command or shell script) will be executed on behalf of
the user who registered it, except if that user is root;
root has the option of specifying an alternate user id (other
than root).
.PP
The default environment settings are specified in
\fI/etc/evlog.d/action_profile\fR, which can be
modified only by root. The action command, or script, can alter
its environment. The initial default is as follows:

.nf
PATH=/usr/bin:/bin:.
PWD=/tmp
	
.fi
.PP
A user attempting to issue the
\fBevlnotify\fR command must have access to at
least one of the log files
(\fI/var/evlog/eventlog\fR or
\fI/var/evlog/privatelog\fR). In addition to
verifying that the user has read access to at least one of the
log files, an additional check is performed using a mechanism
similar to the \fBcrontab\fR command:
.TP 0.2i
\(bu
If the file
\fI/etc/evlog.d/action.allow\fR
exists, then the users listed therein can issue this
command.
.TP 0.2i
\(bu
Otherwise, if the file
\fI/etc/evlog.d/action.deny\fR
exists, but the \fIaction.allow\fR
file does not exist, then users listed in
\fI/etc/evlog.d/action.deny\fR will
not be allowed to issue the
\fBevlnotify\fR command, and all others will
be allowed to issue the command.
.TP 0.2i
\(bu
If neither the
\fIaction.allow\fR nor
\fIaction.deny\fR files exist, then
all users can issue this command. Note that
notifications can only be modified or deleted by the
users who created them.
.PP
There are no command restrictions for root.
.SH "OPTIONS"
.TP
\fB-l, --list\fR
Lists the currently registered
notifications. The list output consists of the
following fields:

.nf
Notify Id : filter : action : user id : once-only : peristent
			
.fi
(\fIonce-only\fR=1 if once-only)
(\fIpersistent\fR=1 if persistent
registration).

For user ID of root, all registered
notifications will be listed. For all other users,
only the notifications containing a user ID matching
that of the user specifying the
\fB--list\fR option will be displayed.

List option will display the notification requests.
.TP
\fB-s, --show \fIname\fB \fR 
option will display the filter, threshold, interval 
for that particular named notification request (see
the --name option).
.TP
\fB-S, --showall\fR
option will display all named notification requests (see
the --name option)
.TP
\fB-a, --add \fInotify-action\fB \fR
Registers
\fInotify-action\fR as the
command line to be executed when an event matching the
specified filter is logged. The command line may
contain  \fI%recid%\fR which will be
replaced by the matching event record ID.  The
\fBevlactiond\fR executes the
\fInotify-action\fR but does not
wait for it to complete. This may require making the
\fInotify-action\fR script
re-entrant, depending upon its purpose. 

The \fB--threshold\fR option lets you specify the number
of events that happen within the time interval before
the action is to be taken. Hence the \fB--interval\fR
must be set.

The \fB--interval\fR option lets you specify the
time interval. The \fB--threshold\fR must be set.

The \fB--name\fR option lets you specify a name for a 
notification request. This option is used together with
threshold, and interval. 

The \fB--any\fR option lets you specify one or more
attibute(s) in the template for the particular event.
 At run time, the event data will be extracted based on
the template. This option does not have any meaning
when threshold < 2. 
 
The \fB--once-only\fR option lets you
specify that the action is to be performed only once
when the first matching event occurs. The default is for
the action to be performed each time a matching event
occurs. 

The \fB--persistent\fR option saves
the registration to the
\fI/etc/evlog.d/action_registry\fR file,
so that when the system reboots, the persistent
registrations will be restored.

The \fB--filter\fR option specifies a filter name
or filter (query) expression.  Only events matching
the filter will trigger the \fInotify-action\fR. See
the \fIevlquery man page\fR for details.  All event
record attributes from the fixed portion of the event
record can be specified.  If no filter is specified,
then every new event received is considered a match.

The \fB--uid\fR option is only
allowed if user is
root. \fIuserid\fR specifies an
alternative to root as the user id which executes the
\fInotify-action\fR.
.TP
\fB-d, --delete \fInotify-id\fB,...\fR
Removes each of the specified
notifications. For user ID of root, any registered
notifications can be removed. For all other users,
only the notifications containing a user ID matching
that of the user specifying the
\fB--delete\fR option can be deleted. The
\fInotify-id\fR's that the user
is allowed to delete can be viewed with the
\fB--list\fR option.
.TP
\fB-c, --change \fInew-notify-action\fB \fInotify-id\fB\fR
Changes the action to be taken when an
event matches the filter with identifier of
\fInotify-id\fR in the action
registry. \fInew-notify-action\fR
replaces the existing action. The
\fInotify-id\fR's that the user
is allowed to change can be viewed with the
\fB--list\fR option. For user ID of root,
any registered notifications can be changed.  For all
other users, only the notifications containing a user
ID matching that of the user specifying the
\fB--change\fR option can be changed.
.TP
\fB-F, --file \fIcmd-file\fB\fR
Allows you to register actions
according to the options stored in the
\fIcmd-file\fR. Each line in the
file is executed as an option to the
\fBevlnotify\fR command and, therefore,
must conform to the convention and permissions defined
for the other  \fBevlnotify\fR
options. For example, a typical entry in the file may
look like this:

.nf
--add '/etc/mail_sysadm %recid%' --filter 'severity==CRIT'
  --persistent
			
.fi
.SH "EXAMPLES"

.TP

\fBExample 1.\fR
.nf
evlnotify -a '/etc/mail_sysadm %recid%' -f 'severity=CRIT' -p
			
.fi

This example registers an action for
subsequent occurrence of events whose severity
is critical. When such an event occurs, the
script \fI/etc/mail_sysadm\fR
is executed, and the record ID is passed as an
argument. An entry is also added to
\fI/etc/evlog.d/action_registry\fR.
.TP
\fBExample 2.\fR

.nf
evlnotify --list
			
.fi
results in:

.nf
1:severity=EMERG:/sbin/evlview -f 'recid=%recid%' 
  -o /tmp/emerg_log:root:1:1
2:severity=CRIT:/home/admin/testscript %recid%:joeusr:0:0
			
.fi

The fields are described above in the
description of the  \fB--list\fR
option. The first item in the list, Notify ID
1, indicates that when an emergency event is
logged the  \fB/sbin/evlview\fR
command is executed with options that will
cause the event record to be appended to the
\fI/tmp/emerg_log\fR file.
User ID is root. Since the "once only"
indicator is set to '1,' this action will take
place only once. The persistent indicator is
set to '1,' which indicates that the
registration is persistent, meaning that is it
read from the
\fIaction_registry\fR
(\fI/etc/evlog.d/action_registry\fR)
and restored on every boot-up.

Notify ID 2 indicates that when a
critical event is logged,
\fI/home/admin/testscript\fR is
executed.  User ID is joeusr.
.SH "FILES"
.TP
\fB\fI/var/evlog/eventlog\fB\fR
Standard Event Log
.TP
\fB\fI/var/evlog/privatelog\fB\fR
Private Log
.TP
\fB\fI/etc/evlog.d/action_registry\fB\fR
Persistent Action Registry
.TP
\fB\fI/etc/evlog.d/action_profile\fB\fR
Default environment for
notify_action
.TP
\fB\fI/etc/evlog.d/action.allow\fB\fR
Users allowed to
register
.TP
\fB\fI/etc/evlog.d/action.deny\fB\fR
Users not allowed to
register

.SH "SEE ALSO"
\fIevlquery man page\fR    Filter expression syntax rules

