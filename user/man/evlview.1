.\" This manpage has been modified by Dennis Grace
.\" of IBM LTC Documentation Services from a document
.\" automatically generated by docbook2man
.\" from a DocBook document.  This tool can be found at:
.\" <http://shell.ipoline.com/~elmert/comp/docbook2X/>
.\" Please send any bug reports, improvements, comments, patches,
.\" etc. to Steve Cheng <steve@ggi-project.org>.
.\" For questions regarding the modifications from the
.\" docbook2man output, contact Dennis Grace at
.\" <dgrace@us.ibm.com>.
.TH "EVLVIEW" "1" "6 December 2002" "" ""
.SH NAME
evlview \- View log events
.SH SYNOPSIS

\fBevlview --help\fR

 OR\fB

\fBevlview \fR\fB[\fB input\fB]
[\fI \fBoutput \fB] [ -f | --filter \fIfilter\fB ]
 [ -b |  --templates ] [ -B | --notemplates ]


\fBinput\fR (defaults to \fI/var/evlog/eventlog\fR,
or to \fI/var/evlog/privatelog\fR with \fB-p | --private\fR):\fB	
 [ -n | --new ][ -T | --timeout \fInsec\fB ][ -R | --recid \fIrid\fR ]
  OR\fB
 [ -l | --log \fIsrclogfile\fB] [ -t | --tail \fInrec\fB ] 
 [ -r | --reverse ]\fR

\fBoutput\fR (defaults to stdout):\fB 
 [ -o | --out \fIdestlogfile\fB ]\fR
  OR\fB
 [ -S | --formatstr \fIformat-string\fB ] [ format_opts ]\fR  
  OR\fB
 [ -F | --formatfile \fIformat-file\fB ] [ format_opts ]\fR
  OR\fB
 [ -c | --compact ] [ -s | --separator \fI'sep'\fB ] [ -q | --nmeqval ] [format_opts]\fR
  OR\fB
 [ -m | --syslog ]\fR

\fBformat_opts\fR:\fB
 [ -N | --newlines \fIn\fB ] [ -d | --datefmt \fIdate-format\fB ]
 
.SH "DESCRIPTION"
.PP
The \fBevlview\fR utility lets you view events
from an event log, view events in real time, or read records from
an event log and write the records to another file.
.SH "OPTIONS"
.TP
\fB-n, --new\fR
Display only new events as they are
logged. By default, events are read from the entire
event log until the end of the log is reached. This
option is not valid when \fB--log\fR specifies an inactive log file.
.TP
\fB-T, --timeout \fInsec\fB\fR
Specifies the interval in seconds that
the viewer should wait for the next event to be
generated. If this interval passes with no new events,
the viewer terminates. The interval restarts with each
new event. By default, with the \fB--new\fR
option, the viewer runs until it is killed. This
option is valid only when the \fB--new\fR
option is used.
.TP
\fB-R, --recid \fIrid\fB\fR
Valid only with \fB--new\fR.
Before displaying new records,
display the end of the existing log,
starting with the first record whose ID is greater than or equal to \fIrid\fR.
.TP
\fB-l, --log \fIsrclogfile\fB\fR
Specifies the name of an alternate log
file as the source of events \(em for example, the private
log \fI/var/evlog/privatelog\fR. Events
read from the private log file can be read only by users
with the appropriate read permission.  If this option is
not specified, events are read from the active system log,
\fI/var/evlog/eventlog\fR.
.TP
\fB-p, --private\fR
Equivalent to \fB--log /var/evlog/privatelog\fR.
.TP
\fB-t, --tail \fInrec\fB\fR
Specifies that \fBevlview\fR
should read the last \fInrec\fR
records in the event log file. If a filter is specified,
then the last \fInrec\fR records
are read that match the filter. 
.TP
\fB-r, --reverse\fR
Read events in reverse order, starting
with the most recently written event. Default is to
read starting with the oldest event in the event log. 
.TP
\fB-o, --out \fIdestlogfile\fB\fR
Specifies that event records should be
appended to the specified
\fIdestlogfile\fR instead of being
displayed to stdout. This option is not valid with the
\fB--formatstr\fR, \fB--formatfile\fR,
\fB--compact\fR, \fB--separator\fR, \fB--datefmt\fR, \fB--newlines\fR,
\fB--neqval\fR,
or \fB--syslog\fR
options. 
.TP
\fB-S, --formatstr \fIformat-string\fB\fR
Specifies an alternative format for events
that are displayed (see Example 3). 

For the fixed portion of the event record, members
are referenced by the attribute names defined in the POSIX
standard: recid, size, format, event_type, facility,
severity, uid, gid, pgrp, time, flags, thread, and
processor.  

An additional attribute is available, \fBhost\fR,
which displays the name of the host that logged the event.

For \fIlog_format\fR of
STRING, %data% displays the variable-length data as
the data string. 

For \fIlog_format\fR of
NODATA, %data% displays a NULL string. 

For \fIlog_format\fR of
BINARY, %data% displays the variable length data
according to the associated formatting template, if any,
or in hex dump format otherwise.

If \fIlog_format\fR is
BINARY and a formatting template exists for the event
record, optional attributes in the variable-length
portion can be referenced by attribute name as defined
in the formatting template. However, the formatting
string (if any) specified in
\fIformat-string\fR is used
instead of the formatting specification from the
template. 

If this option is not specified, then default
formatting is used.  This option is not valid if specified
along with \fB--out\fR,
\fB--formatfile\fR,
\fB--compact\fR, \fB--separator\fR,
\fB--neqval\fR,
or \fB--syslog\fR.
.TP
\fB-F, --formatfile \fIformat-file\fB\fR
Performs the same actions as
\fB--formatstr\fR, but the alternative
format is read from
\fIformat-file\fR. This option is
not valid if specified along with
\fB--out\fR,
\fB--formatstr\fR,
\fB--compact\fR,
\fB--separator\fR,
\fB--neqval\fR,
or \fB--syslog\fR.
.TP
\fB-c, --compact\fR
Specifies that contents of the event
record are displayed in a compact form. In compact form,
the attribute names for attributes in the fixed portion
of the event record are not displayed, only the values.
This option cannot be used with
\fB--formatstr\fR,
\fB--formatfile\fR,
\fB--syslog\fR, or
\fB--out\fR.
.TP
\fB-s, --separator \fIsep\fB\fR
Specifies that the character string
\fI'sep'\fR be used as the separator
between attributes displayed by the viewer. The default
separator is ','.  The separator string cannot exceed 20
characters.  This option is not valid with
\fB--formatstr\fR,
\fB--formatfile\fR,
\fB--syslog\fR, or
\fB--out\fR. 
.TP
\fB-N, --newlines \fIn\fB\fR
When displaying records, ensures that there are exactly \fIn\fR newlines
between records.
For example, \fB-N 2\fR gets you exactly 1 blank line between records.
\fIn\fR must be greater than zero.
If a record ends in more than \fIn\fR newlines,
then an appropriate number of those newlines will be omitted from the display.
If this option is omitted,
\fBevlview\fR ensures that there is at least one newline between records.
This option is not valid with
\fB--out\fR or \fB--syslog\fR.
.TP
\fB-d, --datefmt \fIdateformat\fB\fR
Format the \fIlog_time\fR attribute
according to the \fIdateformat\fR string,
which is passed to the \fIstrftime\fR(3) function.
The default format is "%c".
This option is not valid with
\fB--out\fR or \fB--syslog\fR.
.TP
\fB-m, --syslog\fR
Approximate the output format of the \fIsyslogd\fR(8) daemon:
for each record displayed,
print the timestamp, host name, and message.
For multi-line messages, BINARY-format events,
and events formatted by formatting templates,
the output may not look much like \fIsyslogd\fR output.
This option is not valid with the
\fB--out\fR,
\fB--formatstr\fR, \fB--formatfile\fR,
\fB--nmeqval\fR,
\fB--compact\fR, \fB--separator\fR, \fB--datefmt\fR, or \fB--newlines\fR
options.
.TP
\fB-q, --nmeqval\fR
For records that have associated templates,
display the non-standard attributes in \fIname\fR=\fIvalue\fR format,
one attribute per line.
This option is not valid with the
\fB--notemplates\fR,
\fB--out\fR,
\fB--formatstr\fR, \fB--formatfile\fR,
or \fB--syslog\fR options.
.TP
\fB-f, --filter \fIfilter\fB\fR
Specifies a
.\" filter name or
filter (query)
expression. Only events matching the \fIfilter\fR are displayed.
See the \fIevlquery\fR man page for
more information.
.TP
\fB-b, --templates\fR
Forces non-standard attribute names to be accepted in the filter
expression supplied with the --filter option, as well as the format
specified with the --formatstr or --formatfile option.
A "non-standard" attribute is one defined via a formatting template
rather than in the fixed portion of the event record.   
For a particular event, if the named attribute does not exist,
it will format as a null string,
and references to it in the filter expression will evaluate to false.
.TP    
\fB-B, --notemplates\fR
Specifies that the evlview command should not attempt to locate
formatting templates.  By default, evlview will attempt to use formatting
templates when displaying records.  
.TP
\fB-h, --help \fR
Displays the usage statement.
.SH "EXAMPLES"
.TP
\fBExample 1.\fR
.nf
evlview --filter 'facility==USER && data contains 
   "interface reset"'
                
.fi
might produce the following output (if there are 2
matching events in the log):

.nf
recid=7214, size=31, format=STRING, event_type=0x3, facility=USER,
severity=ERR, uid=bill, gid=appdev, pid=2753, pgrp=44,
time=Mon Jun 18 19:32:31 2001, flags=0x0, thread=0x0, processor=1,
host=linux_host_1.foo.bar.com
Eth/0 interface reset by user

recid=8612, size=31, format=STRING, event_type=0x3, facility=USER,
severity=ERR, uid=bill, gid=appdev, pid=2753, pgrp=44,
time=Wed Jun 20 14:32:31 2001, flags=0x0, thread=0x0, processor=1,
host=linux_host_1.foo.bar.com
Eth/1 interface reset by user

.fi
Note that the date and time format shown in the examples 
is based on the LANG environment variable not being set
(or being set to "C").  For other settings, the format 
will differ.  For example:
.nf

     $export LANG=es_MX    (Spanish, Mexico)

.fi
might result in a display of:
.nf

     lun 04 feb 2002 11:52:18 PST

.fi
.nf
Also, see Example 6 for additional date formatting options.
.fi

.TP
\fBExample 2.\fR
.nf
evlview -f 'facility==LOCAL1 && data contains 
"Eth/0 interface"' --compact -s !
                
.fi
might produce the following:
.nf

7214!31!STRING!0x3!LOCAL1!ERR!bill!appdev!2753!44!
Tue Jun 19 19:32:31 2001!0x0!0x0!1!linux_host_1.foo.bar.com
Eth/0 interface reset by user
.fi
.TP
\fBExample 3.\fR
.nf
evlview -b -f 'facility==LOCAL1 && event_type==0x3115 && lun=0x3'
-S "Logical unit number is 0x%lun:x%\\nfor facility %facility%
and event type of %event_type:d% decimal, %event_type% hex\\n"
                
.fi
might produce the following:
.nf

Logical unit number is 0x3
for facility LOCAL1 and event type of 12565 decimal, 0x3115 hex

.fi
Note that the \fB-b\fR option allows the non-standard attribute "lun" to
be included with the \fB-f (--filter)\fR option.

Also, note that due to the length of the formatting
string, use of the \fB--formatfile\fR
option would be preferable in practice instead of the
\fB-S\fR or \fBformatstr\fR
option. 
.TP
\fBExample 4.\fR
.nf
evlview -f 'age < "2h"'
		
.fi
would display all events logged during the past
2 hours.
.TP
\fBExample 5.\fR
.nf
lastrid=`cat /var/evlog/bootrecid`
nextrid=`expr $lastrid + 1`
evlview -n -R $nextrid -f 'flags & printk' 
   --syslog >> /var/log/printks

.fi
would run continuously, appending to \fI/var/log/printks\fR
all messages logged by the kernel's \fIprintk\fR() function,
starting with the first message after the current boot.
The message format is that of the \fIsyslogd\fP daemon.
.TP
\fBExample 6.\fR
.nf
evlview -b -S "%time% %host% %facility% %severity%  
   %event_type%"  --datefmt "%A %B %d %l:%M:%S %p"
.fi

might display the following:

.nf
   Tuesday June 04  1:29:26 PM elm3b99 KERN NOTICE 0x2ffe11ac 
   Tuesday June 04  1:29:26 PM elm3b99 KERN ALERT 0x5818f89e 
   Tuesday June 04  1:29:26 PM elm3b99 LOGMGMT INFO 0x28 
.fi

and demonstrates the use of the --datefmt option.

.SH "FILES"
.TP
\fB\fI/var/evlog/eventlog\fB\fR
Standard Event log
.TP
\fB\fI/var/evlog/privatelog\fB\fR
Private log


.SH "SEE ALSO"
\fIevlquery\fR man page    Filter expression syntax rules
.br
\fIstrftime\fR(3)\fR man page

.SH "NOTES"
When \fBevlview\fR is interrupted by a log-maintenance operation
(e.g., when \fBevlogmgr\fR runs),
\fBevlview\fR waits until the operation completes
and then picks up where it had left off.
This is intended to work even if the portion of the file where
\fBevlview\fR was reading is deleted during log maintenance.
If a timeout interval is specified with \fB--timeout\fR,
and the timeout expires while \fBevlview\fR is waiting for
completion of the log-maintenance operation,
\fBevlview\fR terminates with an error message.
